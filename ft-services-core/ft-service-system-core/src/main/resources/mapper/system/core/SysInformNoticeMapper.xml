<?xml version="1.0" encoding="UTF-8" ?>
<!DOCTYPE mapper
PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN"
"http://mybatis.org/dtd/mybatis-3-mapper.dtd">
<mapper namespace="com.hhwy.system.core.mapper.SysInformNoticeMapper">
    
    <resultMap type="com.hhwy.system.core.domain.SysInformNotice" id="SysInformNoticeResult">
        <result property="noticeId"    column="notice_id"    />
        <result property="noticeTitle"    column="notice_title"    />
        <result property="noticeType"    column="notice_type"    />
        <result property="noticeContent"    column="notice_content"    />
        <result property="status"    column="status"    />
        <result property="senderId"    column="sender_id"    />
        <result property="senderName"    column="sender_name"    />
        <result property="endTime"    column="end_time"    />
        <result property="correlationLink"    column="correlation_link"    />
        <result property="createUser"    column="create_user"    />
        <result property="createTime"    column="create_time"    />
        <result property="updateUser"    column="update_user"    />
        <result property="updateTime"    column="update_time"    />
        <result property="remark"    column="remark"    />
        <result property="tenantKey"    column="tenant_key"    />
    </resultMap>

    <sql id="selectSysInformNoticeVo">
        select notice_id, notice_title, notice_type, notice_content, status, sender_id, sender_name, end_time, correlation_link, create_user, create_time, update_user, update_time, remark, tenant_key from sys_inform_notice
    </sql>

    <select id="selectSysInformNoticeList" parameterType="com.hhwy.system.core.domain.SysInformNotice" resultMap="SysInformNoticeResult">
        <include refid="selectSysInformNoticeVo"/>
        <where>
            tenant_key = #{tenantKey}
            <if test="noticeTitle != null  and noticeTitle != ''"> and notice_title like concat('%', #{noticeTitle} ,'%')</if>
            <if test="noticeType != null  and noticeType != ''"> and notice_type = #{noticeType}</if>
            <if test="noticeContent != null  and noticeContent != ''"> and notice_content = #{noticeContent}</if>
            <if test="status != null  and status != ''"> and status = #{status}</if>
            <if test="senderId != null  and senderId != ''"> and sender_id = #{senderId}</if>
            <if test="senderName != null  and senderName != ''"> and sender_name like concat('%', #{senderName}, '%')</if>
            <if test="endTime != null "> and end_time = #{endTime}</if>
            <if test="correlationLink != null  and correlationLink != ''"> and correlation_link = #{correlationLink}</if>
            <if test="createUser != null  and createUser != ''"> and create_user = #{createUser}</if>
        </where>
    </select>
    
    <select id="selectSysInformNoticeByNoticeId" parameterType="Long" resultMap="SysInformNoticeResult">
        <include refid="selectSysInformNoticeVo"/>
        where notice_id = #{noticeId}
    </select>

    <select id="getNoticeAboutLoginUser" resultType="com.hhwy.system.core.domain.vo.InformNotice">
        select sn.notice_id id,
               sn.notice_type type,
               sn.notice_title title,
               sn.notice_content description,
               sn.sender_id senderId,
               sn.sender_name senderName,
               sn.correlation_link correlationLink,
               sn.remark reamrk,
               sn.create_time datetime,
               snr.read_status clickClose
        from sys_notice_recipient snr , sys_inform_notice sn
        <where>
            snr.notice_id = sn.notice_id and sn.status = '0' and snr.recipient_id = #{userId} and sn.notice_type = #{noticeType} and sn.tenant_key = #{tenantKey}
            <if test="noticeTitle != null  and noticeTitle != ''"> and sn.notice_title like concat('%',#{noticeTitle},'%') </if>
            <if test="readStatus != null  and readStatus != ''"> and snr.read_status = #{readStatus} </if>
        </where>
        order by snr.read_status
    </select>

    <select id="getAllAnnouncement4LoginUser" resultType="com.hhwy.system.core.domain.vo.InformNotice">
        select sn.notice_id id,
               sn.notice_type type,
               sn.notice_title title,
               sn.notice_content description,
               sn.sender_id senderId,
               sn.sender_name senderName,
               sn.correlation_link correlationLink,
               sn.remark reamrk,
               sn.create_time datetime,
               snr.read_status clickClose
        from sys_inform_notice sn
        left join sys_notice_recipient snr on sn.notice_id = snr.notice_id and snr.recipient_id = #{userId}
        <where>
            sn.notice_type = #{noticeType} and sn.status = '0' and sn.tenant_key = #{tenantKey}
            <if test='readStatus != null  and readStatus == "0"'> and snr.read_status is null </if>
            <if test='readStatus != null  and readStatus == "1"'> and snr.read_status is not null </if>
            <if test="noticeTitle != null  and noticeTitle != ''"> and sn.notice_title like concat('%',#{noticeTitle},'%') </if>
        </where>
        order by snr.read_status
    </select>

    <select id="getAllAnnouncement" resultType="com.hhwy.system.core.domain.vo.InformNotice">
        select sn.notice_id id,
            sn.notice_type type,
            sn.notice_title title,
            sn.notice_content description,
            sn.sender_id senderId,
            sn.sender_name senderName,
            sn.correlation_link correlationLink,
            sn.remark reamrk,
            sn.create_time datetime,
            snr.read_status clickClose
            from sys_inform_notice sn
        left join sys_notice_recipient snr on sn.notice_id = snr.notice_id and snr.recipient_id = #{userId}
        <where>
            sn.notice_type = #{noticeType} and sn.status = '0' and sn.tenant_key = #{tenantKey}
            <if test='readStatus != null  and readStatus == "0"'> and snr.read_status is null </if>
            <if test='readStatus != null  and readStatus == "1"'> and snr.read_status is not null </if>
            <if test="noticeTitle != null  and noticeTitle != ''"> and sn.notice_title like concat('%',#{noticeTitle},'%') </if>
        </where>
        order by snr.read_status
    </select>

    <select id="selectListByNoticeType" resultType="com.hhwy.system.core.domain.vo.InformNotice">
        select sn.notice_id id,
               sn.notice_type type,
               sn.notice_title title,
               sn.notice_content description,
               sn.sender_id senderId,
               sn.sender_name senderName,
               sn.correlation_link correlationLink,
               sn.remark reamrk,
               sn.create_time datetime,
               snr.read_status clickClose
        from sys_notice_recipient snr , sys_inform_notice sn
        where snr.notice_id = sn.notice_id and sn.status = '0' and snr.recipient_id = #{userId} and sn.notice_type = #{noticeType} and sn.tenant_key = #{tenantKey}
        order by snr.read_status
    </select>
    <select id="getInfoById" resultType="com.hhwy.system.core.domain.vo.InformNotice">
        select sn.notice_id id,
               sn.notice_type type,
               sn.notice_title title,
               sn.notice_content description,
               sn.sender_id senderId,
               sn.sender_name senderName,
               sn.correlation_link correlationLink,
               sn.remark reamrk,
               sn.create_time datetime,
               snr.read_status clickClose
        from sys_inform_notice sn
        left join sys_notice_recipient snr on sn.notice_id = snr.notice_id and snr.recipient_id = #{recipientId}
        where
            sn.notice_id = #{noticeId}
    </select>
    <select id="getMessage4LoginUserPost" resultMap="SysInformNoticeResult">
        <include refid="selectSysInformNoticeVo"/>
        <where>
            tenant_key = #{tenantKey} and sender_id = #{userId}
            <if test="noticeTitle != null  and noticeTitle != ''"> and notice_title like concat('%', #{noticeTitle} ,'%')</if>
            <if test="noticeType != null  and noticeType != ''"> and notice_type = #{noticeType}</if>
        </where>
    </select>

    <insert id="insertSysInformNotice" parameterType="com.hhwy.system.core.domain.SysInformNotice" useGeneratedKeys="true" keyProperty="noticeId">
        insert into sys_inform_notice
        <trim prefix="(" suffix=")" suffixOverrides=",">
            <if test="noticeTitle != null and noticeTitle != ''">notice_title,</if>
            <if test="noticeType != null and noticeType != ''">notice_type,</if>
            <if test="noticeContent != null">notice_content,</if>
            <if test="status != null">status,</if>
            <if test="senderId != null">sender_id,</if>
            <if test="senderName != null">sender_name,</if>
            <if test="endTime != null">end_time,</if>
            <if test="correlationLink != null">correlation_link,</if>
            <if test="createUser != null">create_user,</if>
            <if test="createTime != null">create_time,</if>
            <if test="updateUser != null">update_user,</if>
            <if test="updateTime != null">update_time,</if>
            <if test="remark != null">remark,</if>
            <if test="tenantKey != null and tenantKey != ''">tenant_key,</if>
         </trim>
        <trim prefix="values (" suffix=")" suffixOverrides=",">
            <if test="noticeTitle != null and noticeTitle != ''">#{noticeTitle},</if>
            <if test="noticeType != null and noticeType != ''">#{noticeType},</if>
            <if test="noticeContent != null">#{noticeContent},</if>
            <if test="status != null">#{status},</if>
            <if test="senderId != null">#{senderId},</if>
            <if test="senderName != null">#{senderName},</if>
            <if test="endTime != null">#{endTime},</if>
            <if test="correlationLink != null">#{correlationLink},</if>
            <if test="createUser != null">#{createUser},</if>
            <if test="createTime != null">#{createTime},</if>
            <if test="updateUser != null">#{updateUser},</if>
            <if test="updateTime != null">#{updateTime},</if>
            <if test="remark != null">#{remark},</if>
            <if test="tenantKey != null and tenantKey != ''">#{tenantKey},</if>
         </trim>
    </insert>

    <update id="updateSysInformNotice" parameterType="com.hhwy.system.core.domain.SysInformNotice">
        update sys_inform_notice
        <trim prefix="SET" suffixOverrides=",">
            <if test="noticeTitle != null and noticeTitle != ''">notice_title = #{noticeTitle},</if>
            <if test="noticeType != null and noticeType != ''">notice_type = #{noticeType},</if>
            <if test="noticeContent != null">notice_content = #{noticeContent},</if>
            <if test="status != null">status = #{status},</if>
            <if test="senderId != null">sender_id = #{senderId},</if>
            <if test="senderName != null">sender_name = #{senderName},</if>
            <if test="endTime != null">end_time = #{endTime},</if>
            <if test="correlationLink != null">correlation_link = #{correlationLink},</if>
            <if test="createUser != null">create_user = #{createUser},</if>
            <if test="createTime != null">create_time = #{createTime},</if>
            <if test="updateUser != null">update_user = #{updateUser},</if>
            <if test="updateTime != null">update_time = #{updateTime},</if>
            <if test="remark != null">remark = #{remark},</if>
            <if test="tenantKey != null and tenantKey != ''">tenant_key = #{tenantKey},</if>
        </trim>
        where notice_id = #{noticeId}
    </update>

    <delete id="deleteSysInformNoticeByNoticeId" parameterType="Long">
        delete from sys_inform_notice where notice_id = #{noticeId}
    </delete>

    <delete id="deleteSysInformNoticeByNoticeIds" parameterType="String">
        delete from sys_inform_notice where notice_id in 
        <foreach item="noticeId" collection="array" open="(" separator="," close=")">
            #{noticeId}
        </foreach>
    </delete>
</mapper>